<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das Corre√ß√µes de Interface - Editaliza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
    <script src="js/checklist.js"></script>
    <script src="js/timer.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .test-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .status-ok { color: #16a34a; font-weight: bold; }
        .status-error { color: #dc2626; font-weight: bold; }
        .status-warning { color: #d97706; font-weight: bold; }
    </style>
</head>
<body class="bg-gray-50 p-6">
    <!-- Modal de Sess√£o de Estudo (para testes) -->
    <div id="studySessionModal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-70 z-40 flex items-center justify-center p-4 opacity-0">
        <div id="studySessionModalContainer" class="modal-container bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-2xl transform scale-95 max-h-[90vh] overflow-y-auto">
        </div>
    </div>

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">üîß Teste das Corre√ß√µes de Interface</h1>
        <p class="text-gray-600 text-center mb-8">Testando as 5 corre√ß√µes cr√≠ticas implementadas</p>
        
        <!-- TESTE 1: Modal do Checklist -->
        <div class="test-card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‚úÖ CORRE√á√ÉO 1: Modal do Checklist</h2>
            <p class="text-gray-600 mb-4"><strong>Problema:</strong> Modal n√£o fechava ao clicar fora</p>
            <p class="text-gray-600 mb-4"><strong>Solu√ß√£o:</strong> Adicionado listener para detectar cliques no overlay</p>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-blue-800"><strong>Como testar:</strong></p>
                <p class="text-sm text-blue-700">1. Clique no bot√£o abaixo para abrir o modal</p>
                <p class="text-sm text-blue-700">2. Clique fora do modal (no fundo escuro)</p>
                <p class="text-sm text-blue-700">3. O modal deve fechar automaticamente</p>
            </div>
            
            <button id="testModal1" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                üß™ Testar Modal do Checklist
            </button>
            <div id="status1" class="mt-3 text-sm"></div>
        </div>

        <!-- TESTE 2: L√≥gica do Cron√¥metro -->
        <div class="test-card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‚è∞ CORRE√á√ÉO 2: L√≥gica do Cron√¥metro</h2>
            <p class="text-gray-600 mb-4"><strong>Problema:</strong> Timer iniciava mesmo clicando "Pular dessa vez"</p>
            <p class="text-gray-600 mb-4"><strong>Solu√ß√£o:</strong> Par√¢metro shouldStartTimer controla se o timer inicia automaticamente</p>
            
            <div class="bg-green-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-green-800"><strong>Como testar:</strong></p>
                <p class="text-sm text-green-700">1. Clique em "Testar com Checklist" ‚Üí Complete checklist ‚Üí Timer inicia</p>
                <p class="text-sm text-green-700">2. Clique em "Testar Pular" ‚Üí Clique "Pular dessa vez" ‚Üí Timer fica pausado</p>
            </div>
            
            <div class="space-x-4">
                <button id="testTimer1" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium">
                    üß™ Testar com Checklist
                </button>
                <button id="testTimer2" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-medium">
                    üß™ Testar "Pular"
                </button>
            </div>
            <div id="status2" class="mt-3 text-sm"></div>
        </div>

        <!-- TESTE 3: Salvamento de Sess√£o -->
        <div class="test-card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üíæ CORRE√á√ÉO 3: Salvamento de Sess√£o</h2>
            <p class="text-gray-600 mb-4"><strong>Problema:</strong> "Erro ao salvar dados da sess√£o" ao marcar como conclu√≠do</p>
            <p class="text-gray-600 mb-4"><strong>Solu√ß√£o:</strong> Endpoints corretos (/schedules/sessions/) e melhor tratamento de erros</p>
            
            <div class="bg-purple-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-purple-800"><strong>Endpoints corrigidos:</strong></p>
                <p class="text-sm text-purple-700">‚Ä¢ Notas e quest√µes: PATCH /schedules/sessions/{id}</p>
                <p class="text-sm text-purple-700">‚Ä¢ Status da sess√£o: PATCH /schedules/sessions/{id}</p>
                <p class="text-sm text-purple-700">‚Ä¢ Logs detalhados no console</p>
            </div>
            
            <div id="status3" class="status-ok">‚úÖ Implementado - Testar em sess√£o real</div>
        </div>

        <!-- TESTE 4: C√°lculo de Proje√ß√£o -->
        <div class="test-card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üìä CORRE√á√ÉO 4: C√°lculo de Proje√ß√£o</h2>
            <p class="text-gray-600 mb-4"><strong>Problema:</strong> "No ritmo para conclus√£o" aparecia mesmo com ~0% estudado</p>
            <p class="text-gray-600 mb-4"><strong>Solu√ß√£o:</strong> Verifica√ß√£o de progresso m√≠nimo antes de mostrar proje√ß√µes</p>
            
            <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-indigo-800"><strong>L√≥gica implementada:</strong></p>
                <p class="text-sm text-indigo-700">‚Ä¢ Se progresso = 0%: Mensagem motivacional "Vamos Come√ßar!"</p>
                <p class="text-sm text-indigo-700">‚Ä¢ Se progresso > 0%: C√°lculos de proje√ß√£o e ritmo</p>
                <p class="text-sm text-indigo-700">‚Ä¢ Tela plan.html atualizada</p>
            </div>
            
            <button id="testProjection" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium">
                üß™ Ver na P√°gina Plan.html
            </button>
            <div id="status4" class="status-ok mt-3">‚úÖ Implementado - Verificar em plan.html</div>
        </div>

        <!-- TESTE 5: Avatar na Navega√ß√£o -->
        <div class="test-card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üë§ CORRE√á√ÉO 5: Avatar na Navega√ß√£o</h2>
            <p class="text-gray-600 mb-4"><strong>Problema:</strong> Avatar n√£o aparecia na barra de t√≠tulo</p>
            <p class="text-gray-600 mb-4"><strong>Solu√ß√£o:</strong> Endpoint correto, cache otimizado, URLs corrigidas</p>
            
            <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-yellow-800"><strong>Melhorias implementadas:</strong></p>
                <p class="text-sm text-yellow-700">‚Ä¢ Endpoint correto: GET /users/profile</p>
                <p class="text-sm text-yellow-700">‚Ä¢ Cache reduzido para 2 minutos</p>
                <p class="text-sm text-yellow-700">‚Ä¢ Suporte para avatares Google e locais</p>
                <p class="text-sm text-yellow-700">‚Ä¢ Cache buster para avatares locais</p>
                <p class="text-sm text-yellow-700">‚Ä¢ Logs detalhados de debug</p>
            </div>
            
            <button id="testAvatar" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-medium">
                üß™ Testar Carregamento do Avatar
            </button>
            <div id="status5" class="mt-3 text-sm"></div>
        </div>

        <!-- Resumo -->
        <div class="test-card bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200">
            <h2 class="text-xl font-bold text-green-800 mb-4">üìã Resumo das Corre√ß√µes</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold text-green-700 mb-2">‚úÖ Corre√ß√µes Implementadas:</h3>
                    <ul class="text-sm text-green-600 space-y-1">
                        <li>‚Ä¢ Modal fecha ao clicar fora</li>
                        <li>‚Ä¢ Timer s√≥ inicia quando necess√°rio</li>
                        <li>‚Ä¢ Endpoints de salvamento corrigidos</li>
                        <li>‚Ä¢ Proje√ß√µes baseadas em progresso real</li>
                        <li>‚Ä¢ Avatar na navega√ß√£o funcionando</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-blue-700 mb-2">üîç Pr√≥ximos Passos:</h3>
                    <ul class="text-sm text-blue-600 space-y-1">
                        <li>‚Ä¢ Testar com conta real (3@3.com)</li>
                        <li>‚Ä¢ Verificar salvamento de sess√µes</li>
                        <li>‚Ä¢ Confirmar c√°lculos de proje√ß√£o</li>
                        <li>‚Ä¢ Validar avatar em todas as p√°ginas</li>
                        <li>‚Ä¢ Testar intera√ß√£o completa</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados de teste para simular uma sess√£o
        const mockSession = {
            id: 999,
            subject_name: "Direito Constitucional",
            topic_description: "Princ√≠pios fundamentais da Constitui√ß√£o Federal",
            status: "Pendente",
            notes: "",
            questions_solved: 0,
            study_plan_id: 1
        };

        document.getElementById('testModal1').addEventListener('click', () => {
            document.getElementById('status1').innerHTML = '<span class="status-warning">üß™ Testando... Clique fora do modal para verificar se fecha</span>';
            StudyChecklist.show(mockSession);
        });

        document.getElementById('testTimer1').addEventListener('click', () => {
            document.getElementById('status2').innerHTML = '<span class="status-warning">üß™ Testando... Complete o checklist e veja se o timer inicia</span>';
            StudyChecklist.show(mockSession);
        });

        document.getElementById('testTimer2').addEventListener('click', () => {
            document.getElementById('status2').innerHTML = '<span class="status-warning">üß™ Testando... Clique "Pular dessa vez" e veja se o timer fica pausado</span>';
            StudyChecklist.show(mockSession);
        });

        document.getElementById('testProjection').addEventListener('click', () => {
            window.open('plan.html?id=3', '_blank');
        });

        document.getElementById('testAvatar').addEventListener('click', async () => {
            const status = document.getElementById('status5');
            status.innerHTML = '<span class="status-warning">üß™ Testando carregamento do avatar...</span>';
            
            try {
                // Limpar cache
                components.clearUserAvatarCache();
                
                // Tentar carregar avatar
                const avatar = await components.loadUserAvatar();
                
                if (avatar) {
                    status.innerHTML = `<span class="status-ok">‚úÖ Avatar carregado: ${avatar}</span>`;
                    
                    // Atualizar navega√ß√£o se existir
                    if (typeof components.updateNavigationAvatar === 'function') {
                        await components.updateNavigationAvatar();
                        status.innerHTML += '<br><span class="status-ok">‚úÖ Navega√ß√£o atualizada!</span>';
                    }
                } else {
                    status.innerHTML = '<span class="status-warning">‚ö†Ô∏è Nenhum avatar encontrado (normal se n√£o estiver logado)</span>';
                }
            } catch (error) {
                console.error('Erro no teste de avatar:', error);
                status.innerHTML = `<span class="status-error">‚ùå Erro: ${error.message}</span>`;
            }
        });

        // Inicializar componentes globais
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof components !== 'undefined') {
                components.renderGlobalUI();
            }
        });
    </script>
</body>
</html>