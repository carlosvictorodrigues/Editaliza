<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Editaliza</title>
    
    <!-- Favicon and Web App Icons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F7FAFC">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/footer.css" rel="stylesheet">
    <link href="css/light-mode-only.css" rel="stylesheet">
    <!-- Theme system completely removed - light mode only -->
    <!-- SCRIPTS CENTRALIZADOS -->
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
    <!-- Config do Tailwind para reconhecer as cores customizadas -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'editaliza-blue': '#0528f2',
                        'editaliza-green': '#1ad937',
                        'editaliza-black': '#0d0d0d',
                        'editaliza-gray': '#969696',
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos espec√≠ficos da p√°gina */
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease; }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Dashboard Cards - Melhor espa√ßamento e anima√ß√µes sutis */
        .dashboard-card {
            transform: translateY(10px);
            opacity: 0;
            animation: cardFadeIn 0.6s ease-out forwards;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-card:nth-child(1) { animation-delay: 0.1s; }
        .dashboard-card:nth-child(2) { animation-delay: 0.2s; }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--editaliza-blue), transparent);
            transition: left 0.6s ease;
        }
        
        .dashboard-card:hover::before {
            left: 100%;
        }
        
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(5, 40, 242, 0.15);
            border-color: rgba(5, 40, 242, 0.1);
        }
        
        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Micro-intera√ß√µes para bot√µes */
        .btn-primary {
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }
        
        .btn-primary:active::after {
            width: 300px;
            height: 300px;
        }
        
        /* √çcones com anima√ß√£o suave */
        .icon-bounce {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover .icon-bounce {
            transform: scale(1.1) rotate(5deg);
        }
        
        /* Templates com efeito hover melhorado */
        .template-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .template-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: var(--editaliza-blue);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .template-btn:hover::before {
            transform: scaleY(1);
        }
        
        .template-btn:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(5, 40, 242, 0.1);
        }
        
        /* Lista de planos com anima√ß√£o */
        .plan-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
        }
        
        .plan-item:hover {
            border-left-color: var(--editaliza-blue);
            transform: translateX(4px);
            background: linear-gradient(90deg, rgba(5, 40, 242, 0.02), transparent);
        }
        
        /* Preview de tempo com efeito especial */
        #timePreview {
            transform: translateY(-10px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #timePreview:not(.hidden) {
            transform: translateY(0);
            opacity: 1;
            animation: pulseGlow 2s ease-in-out;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }
        
        /* Form inputs com feedback visual */
        .form-input {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .form-input:focus {
            transform: translateY(-2px);
        }
        
        /* Motivational card com gradiente sutil */
        .motivational-card {
            background: linear-gradient(135deg, rgba(5, 40, 242, 0.05), rgba(59, 130, 246, 0.02));
            border-left: 4px solid var(--editaliza-blue);
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">
    <!-- NAVEGA√á√ÉO PRINCIPAL (GERADA PELO JS) -->
    <div id="main-nav-container"></div>
    
    <!-- Main content wrapper with flex-1 to push footer to bottom -->
    <div class="flex-1">

    <!-- Modal de Confirma√ß√£o para Exclus√£o -->
    <div id="deleteConfirmationModal" class="modal-overlay hidden fixed inset-0 bg-editaliza-black bg-opacity-70 z-50 flex items-center justify-center p-4 opacity-0">
        <div class="modal-container bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md transform scale-95">
            <h2 class="text-2xl font-bold text-editaliza-black">Confirmar Exclus√£o</h2>
            <p class="mt-2 text-gray-600">Voc√™ tem certeza que deseja apagar o plano "<strong id="planNameToDelete"></strong>"?</p>
            <p class="mt-4 text-sm font-semibold text-red-700 bg-red-50 p-3 rounded-lg border border-red-200">
                Aten√ß√£o: Todos os dados associados ser√£o permanentemente removidos. Esta a√ß√£o n√£o pode ser desfeita.
            </p>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancelDeleteButton" class="px-6 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 font-semibold transition-colors">Cancelar</button>
                <button id="confirmDeleteButton" class="btn-danger px-6 py-2">Apagar</button>
            </div>
        </div>
    </div>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-editaliza-black">Meus Planos de Estudo</h1>
            <p class="text-md text-editaliza-gray mt-1">Gerencie seus planos existentes ou crie um novo para come√ßar.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <!-- Coluna da Lista de Planos -->
            <div class="dashboard-card h-fit">
                <h2 class="text-2xl font-semibold mb-6 border-b pb-4 text-gray-700 flex items-center">
                    <span class="text-2xl mr-3 icon-bounce">üóÇÔ∏è</span> Selecione um Plano
                </h2>
                <div id="planList" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">Carregando seus planos...</p>
                </div>
            </div>

            <!-- Coluna de Cria√ß√£o de Novo Plano -->
            <div class="dashboard-card h-fit">
                <h2 class="text-2xl font-semibold mb-6 text-gray-700 flex items-center">
                    <span class="text-2xl mr-3 icon-bounce">‚ú®</span> Criar Novo Plano
                </h2>
                
                <!-- Orienta√ß√£o Motivacional -->
                <div class="motivational-card bg-blue-50 p-5 rounded-lg mb-6">
                    <div class="flex items-start">
                        <span class="text-2xl mr-3 icon-bounce">üéØ</span>
                        <div>
                            <h3 class="font-semibold text-editaliza-blue mb-2">Seu primeiro passo rumo √† aprova√ß√£o!</h3>
                            <p class="text-sm text-gray-700">Vamos criar um plano personalizado para voc√™. Depois vou te ajudar passo a passo na configura√ß√£o.</p>
                        </div>
                    </div>
                </div>
                
                <form id="newPlanForm" class="space-y-5">
                    <div>
                        <label for="plan_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome do Plano
                            <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="plan_name" class="form-input" placeholder="Ex: Concurso TJCE 2025, ENEM 2025, OAB 1¬™ Fase" required>
                        <p class="text-xs text-gray-500 mt-2 flex items-center">
                            <span class="mr-1">üí°</span>
                            <span>Dica: Use o nome do concurso e o ano para facilitar a organiza√ß√£o</span>
                        </p>
                    </div>
                    
                    <div>
                        <label for="exam_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Data da Prova
                            <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="exam_date" class="form-input" required>
                        <p class="text-xs text-gray-500 mt-2 flex items-center">
                            <span class="mr-1">üìÖ</span>
                            <span>Vou calcular automaticamente o tempo dispon√≠vel para seus estudos</span>
                        </p>
                    </div>
                    
                    <!-- Preview do Tempo Dispon√≠vel -->
                    <div id="timePreview" class="hidden bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center text-green-700">
                            <span class="mr-2 text-lg">‚è∞</span>
                            <span id="timePreviewText" class="text-sm font-medium"></span>
                        </div>
                    </div>
                    
                    <button type="submit" id="createPlanButton" class="btn-primary group">
                        <span class="flex items-center justify-center">
                            Criar Meu Plano!
                            <span class="ml-2 transform group-hover:translate-x-1 transition-transform">‚Üí</span>
                        </span>
                    </button>
                </form>
                
                <!-- Templates Sugeridos -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-sm font-semibold text-gray-600 mb-4 flex items-center">
                        <span class="mr-2 icon-bounce">üöÄ</span>
                        <span>Templates Populares</span>
                    </h3>
                    <div class="space-y-3">
                        <button type="button" class="template-btn w-full text-left p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors" data-name="Concurso P√∫blico Federal" data-months="6">
                            <div class="font-medium text-sm text-gray-700 flex items-center">
                                <span class="mr-2">‚öñÔ∏è</span>
                                <span>Concurso P√∫blico Federal</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1 ml-6">Prepara√ß√£o completa de 6 meses</div>
                        </button>
                        <button type="button" class="template-btn w-full text-left p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors" data-name="OAB" data-months="3">
                            <div class="font-medium text-sm text-gray-700 flex items-center">
                                <span class="mr-2">üèõÔ∏è</span>
                                <span>Exame da OAB</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1 ml-6">Foco intensivo de 3 meses</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const deleteModal = document.getElementById('deleteConfirmationModal');
        let planIdToDelete = null;

        function openDeleteModal(planId, planName) {
            planIdToDelete = planId;
            document.getElementById('planNameToDelete').textContent = planName;
            deleteModal.classList.remove('hidden');
            setTimeout(() => {
                deleteModal.classList.remove('opacity-0');
                deleteModal.querySelector('.modal-container').classList.remove('scale-95');
            }, 10);
        }

        function closeDeleteModal() {
            deleteModal.classList.add('opacity-0');
            deleteModal.querySelector('.modal-container').classList.add('scale-95');
            setTimeout(() => {
                deleteModal.classList.add('hidden');
                planIdToDelete = null;
            }, 300);
        }

        async function fetchAndDisplayPlans() {
            app.showSpinner();
            try {
                const plans = await app.apiFetch("/plans"); 
                const planList = document.getElementById('planList');
                planList.innerHTML = '';

                if (plans.length === 0) {
                    planList.innerHTML = `
                        <div class="text-center p-6 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-center justify-center mb-2">
                                <span class="text-2xl icon-bounce">üåü</span>
                            </div>
                            <p class="text-yellow-800 font-medium">Vamos come√ßar?</p>
                            <p class="text-yellow-700 text-sm mt-1">Crie o seu primeiro plano de estudos ao lado!</p>
                        </div>
                    `;
                    return;
                }

                plans.forEach((plan, index) => {
                    const planElement = document.createElement('div');
                    planElement.className = 'plan-item flex justify-between items-center p-4 border rounded-lg hover:bg-slate-50 hover:shadow-sm transition-all duration-200';
                    planElement.style.animationDelay = `${index * 0.1}s`;
                    const examDate = new Date(plan.exam_date + 'T00:00:00');

                    planElement.innerHTML = `
                        <a href="plan_settings.html?id=${plan.id}" class="flex-grow group flex items-center">
                            <span class="text-lg mr-3 icon-bounce">üìö</span>
                            <div>
                                <h3 class="font-semibold text-lg text-editaliza-blue group-hover:text-blue-700 transition-colors">${plan.plan_name}</h3>
                                <p class="text-sm text-editaliza-gray flex items-center">
                                    <span class="mr-1">üìÖ</span>
                                    <span>Data da Prova: ${examDate.toLocaleDateString('pt-BR')}</span>
                                </p>
                            </div>
                        </a>
                        <button onclick="openDeleteModal(${plan.id}, '${plan.plan_name.replace(/'/g, "\\'")}')" class="btn-danger-outline transition-all hover:scale-105">
                            üóëÔ∏è Apagar
                        </button>
                    `;
                    planList.appendChild(planElement);
                });
            } catch (error) {
                app.showToast(error.message, 'error');
                document.getElementById('planList').innerHTML = '<p class="text-red-500 text-center py-4">N√£o foi poss√≠vel carregar os planos.</p>';
            } finally {
                app.hideSpinner();
            }
        }

        async function confirmDelete() {
            if (!planIdToDelete) return;
            
            app.showSpinner();
            closeDeleteModal();

            try {
                const data = await app.apiFetch(`/plans/${planIdToDelete}`, { method: 'DELETE' });
                app.showToast(data.message, 'success');
                await fetchAndDisplayPlans();
            } catch (error) {
                app.showToast(error.message, 'error');
            } finally {
                app.hideSpinner();
            }
        }

        async function initialize() {
            await components.renderMainNavigation('dashboard.html');
            fetchAndDisplayPlans();
            
            const examDateInput = document.getElementById('exam_date');
            const timePreview = document.getElementById('timePreview');
            const timePreviewText = document.getElementById('timePreviewText');
            
            // Define data m√≠nima como hoje
            examDateInput.min = new Date().toISOString().split("T")[0];
            
            // Preview de tempo em tempo real
            examDateInput.addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const today = new Date();
                const timeDiff = selectedDate - today;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                if (daysDiff > 0) {
                    timePreview.classList.remove('hidden');
                    const months = Math.floor(daysDiff / 30);
                    const remainingDays = daysDiff % 30;
                    
                    let timeText = `Voc√™ tem ${daysDiff} dias para estudar`;
                    if (months > 0) {
                        timeText = `${months} ${months === 1 ? 'm√™s' : 'meses'}`;
                        if (remainingDays > 0) {
                            timeText += ` e ${remainingDays} ${remainingDays === 1 ? 'dia' : 'dias'}`;
                        }
                        timeText = `Voc√™ tem ${timeText} para estudar ‚Äì vamos aproveitar cada dia! üí™`;
                    } else if (daysDiff < 30) {
                        timeText += ` ‚Äì prepara√ß√£o intensiva! üî•`;
                    }
                    
                    timePreviewText.textContent = timeText;
                } else {
                    timePreview.classList.add('hidden');
                }
            });
            
            // Templates r√°pidos
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const months = parseInt(this.dataset.months);
                    
                    document.getElementById('plan_name').value = name;
                    
                    // Calcula data baseada nos meses
                    const futureDate = new Date();
                    futureDate.setMonth(futureDate.getMonth() + months);
                    document.getElementById('exam_date').value = futureDate.toISOString().split('T')[0];
                    
                    // Trigger do evento de preview
                    examDateInput.dispatchEvent(new Event('change'));
                    
                    // Feedback visual melhorado
                    this.classList.add('bg-blue-100', 'border-blue-300');
                    this.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        this.classList.remove('bg-blue-100', 'border-blue-300');
                        this.style.transform = '';
                    }, 1000);
                });
            });
            
            document.getElementById('newPlanForm').addEventListener('submit', async (event) => {
                event.preventDefault();
                const button = document.getElementById('createPlanButton');
                const plan_name = document.getElementById('plan_name').value;
                const exam_date = document.getElementById('exam_date').value;

                button.disabled = true;
                button.innerHTML = '<span class="flex items-center justify-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Criando seu plano...</span>';
                app.showSpinner();

                try {
                    const data = await app.apiFetch('/plans', {
                        method: 'POST',
                        body: JSON.stringify({ plan_name, exam_date })
                    });
                    
                    // Feedback de sucesso antes da transi√ß√£o
                    button.innerHTML = '<span class="flex items-center justify-center text-green-600"><svg class="mr-2 h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>‚ú® Plano criado! Redirecionando...</span>';
                    button.style.transform = 'scale(1.05)';
                    
                    setTimeout(() => {
                        window.location.href = `plan_settings.html?id=${data.newPlanId}&new=true&guide=true`;
                    }, 1200);
                } catch (error) {
                    app.showToast(error.message, 'error');
                    button.disabled = false;
                    button.innerHTML = '<span class="flex items-center justify-center">Criar Meu Plano! <span class="ml-2 transform group-hover:translate-x-1 transition-transform">‚Üí</span></span>';
                    app.hideSpinner();
                }
            });
            
            document.getElementById('cancelDeleteButton').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDeleteButton').addEventListener('click', confirmDelete);
            deleteModal.addEventListener('click', (event) => {
                if (event.target === deleteModal) closeDeleteModal();
            });
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
    
    </div> <!-- End main content wrapper -->
    
    <!-- Script do rodap√© modular -->
    <script src="js/footer.js"></script>
    <!-- O rodap√© ser√° inserido automaticamente aqui pelo footer.js -->
</body>
</html>
