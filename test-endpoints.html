<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste dos Endpoints de GamificaÃ§Ã£o - Editaliza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .endpoint-card {
            border-left: 4px solid #3b82f6;
        }
        .success { border-left-color: #10b981; }
        .error { border-left-color: #ef4444; }
        .loading { border-left-color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">ğŸ§ª Teste dos Endpoints de GamificaÃ§Ã£o</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Teste GamificaÃ§Ã£o -->
            <div id="gamification-card" class="endpoint-card bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š /plans/1/gamification</h3>
                <button onclick="testGamification()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4">
                    Testar Endpoint
                </button>
                <div id="gamification-result" class="text-sm text-gray-600">
                    Clique para testar...
                </div>
            </div>
            
            <!-- Teste SessÃµes Completadas -->
            <div id="completed-card" class="endpoint-card bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">âœ… /plans/1/sessions/completed</h3>
                <button onclick="testCompletedSessions()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-4">
                    Testar Endpoint
                </button>
                <div id="completed-result" class="text-sm text-gray-600">
                    Clique para testar...
                </div>
            </div>
            
            <!-- Teste User Stats -->
            <div id="stats-card" class="endpoint-card bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ /plans/1/user_stats</h3>
                <button onclick="testUserStats()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 mb-4">
                    Testar Endpoint
                </button>
                <div id="stats-result" class="text-sm text-gray-600">
                    Clique para testar...
                </div>
            </div>
            
            <!-- Teste Som do Pomodoro -->
            <div id="audio-card" class="endpoint-card bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">ğŸ”Š Teste do Som do Pomodoro</h3>
                <button onclick="testPomodoroSound()" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 mb-4">
                    Testar Som
                </button>
                <div id="audio-result" class="text-sm text-gray-600">
                    Clique para testar o som...
                </div>
            </div>
        </div>
        
        <!-- Logs -->
        <div class="mt-8 bg-black text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
            <div id="console-log">ğŸ–¥ï¸ Console de Logs</div>
        </div>
    </div>

    <script>
        // Override console.log para mostrar no HTML
        const originalLog = console.log;
        const logContainer = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, arguments);
            logContainer.innerHTML += '<br>' + args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        // SimulaÃ§Ã£o de token para testes (normalmente viria do localStorage)
        const mockToken = 'test-token';
        
        // FunÃ§Ã£o para fazer requisiÃ§Ãµes simuladas
        async function makeRequest(url, description) {
            console.log(`ğŸ”„ Testando: ${description}`);
            console.log(`ğŸ“¡ URL: ${url}`);
            
            try {
                // Simular resposta baseada no endpoint
                let mockResponse;
                
                if (url.includes('/gamification')) {
                    mockResponse = {
                        studyStreak: 3,
                        totalStudyDays: 15,
                        experiencePoints: 1500,
                        concurseiroLevel: 'Aprendiz ğŸ’ª',
                        achievements: ['Primeira Semana', '10 Dias de Estudos'],
                        completedTopicsCount: 25,
                        totalCompletedSessions: 45,
                        currentStreak: 3,
                        totalXP: 1500,
                        level: 3,
                        levelName: 'Aprendiz ğŸ’ª',
                        achievementsCount: 2
                    };
                } else if (url.includes('/sessions/completed')) {
                    mockResponse = {
                        sessions: [
                            {
                                id: 1,
                                status: 'ConcluÃ­do',
                                completed_at: new Date().toISOString(),
                                time_spent: 1800,
                                session_type: 'Novo TÃ³pico'
                            },
                            {
                                id: 2,
                                status: 'ConcluÃ­do',
                                completed_at: new Date(Date.now() - 86400000).toISOString(),
                                time_spent: 2400,
                                session_type: 'RevisÃ£o 7D'
                            }
                        ]
                    };
                } else if (url.includes('/user_stats')) {
                    mockResponse = {
                        totalXP: 1500,
                        completedTopics: 25,
                        totalTopics: 100,
                        achievements: ['Primeira Semana', '10 Dias de Estudos'],
                        progressPercentage: 25
                    };
                }
                
                // Simular delay de rede
                await new Promise(resolve => setTimeout(resolve, 500));
                
                console.log(`âœ… Sucesso:`, mockResponse);
                return mockResponse;
                
            } catch (error) {
                console.log(`âŒ Erro:`, error.message);
                throw error;
            }
        }
        
        function setCardStatus(cardId, status) {
            const card = document.getElementById(cardId);
            card.classList.remove('success', 'error', 'loading');
            card.classList.add(status);
        }
        
        function setResult(resultId, content, isError = false) {
            const element = document.getElementById(resultId);
            element.innerHTML = content;
            element.className = isError ? 
                'text-sm text-red-600 bg-red-50 p-2 rounded' : 
                'text-sm text-green-600 bg-green-50 p-2 rounded';
        }
        
        async function testGamification() {
            setCardStatus('gamification-card', 'loading');
            setResult('gamification-result', 'â³ Carregando dados de gamificaÃ§Ã£o...');
            
            try {
                const data = await makeRequest('/plans/1/gamification', 'Dados de GamificaÃ§Ã£o');
                setCardStatus('gamification-card', 'success');
                setResult('gamification-result', 
                    `ğŸ‰ Sucesso!<br>
                    ğŸ“Š Dias estudados: ${data.totalStudyDays}<br>
                    ğŸ”¥ SequÃªncia: ${data.studyStreak} dias<br>
                    â­ NÃ­vel: ${data.concurseiroLevel}<br>
                    ğŸ† XP: ${data.experiencePoints}`
                );
            } catch (error) {
                setCardStatus('gamification-card', 'error');
                setResult('gamification-result', `âŒ Erro: ${error.message}`, true);
            }
        }
        
        async function testCompletedSessions() {
            setCardStatus('completed-card', 'loading');
            setResult('completed-result', 'â³ Carregando sessÃµes completadas...');
            
            try {
                const data = await makeRequest('/plans/1/sessions/completed', 'SessÃµes Completadas');
                setCardStatus('completed-card', 'success');
                setResult('completed-result', 
                    `âœ… Sucesso!<br>
                    ğŸ“š SessÃµes encontradas: ${data.sessions.length}<br>
                    ğŸ•’ Mais recente: ${new Date(data.sessions[0].completed_at).toLocaleString('pt-BR')}`
                );
            } catch (error) {
                setCardStatus('completed-card', 'error');
                setResult('completed-result', `âŒ Erro: ${error.message}`, true);
            }
        }
        
        async function testUserStats() {
            setCardStatus('stats-card', 'loading');
            setResult('stats-result', 'â³ Carregando estatÃ­sticas do usuÃ¡rio...');
            
            try {
                const data = await makeRequest('/plans/1/user_stats', 'EstatÃ­sticas do UsuÃ¡rio');
                setCardStatus('stats-card', 'success');
                setResult('stats-result', 
                    `ğŸ“ˆ Sucesso!<br>
                    âœ… TÃ³picos concluÃ­dos: ${data.completedTopics}/${data.totalTopics}<br>
                    ğŸ“Š Progresso: ${data.progressPercentage}%<br>
                    ğŸ–ï¸ Conquistas: ${data.achievements.length}`
                );
            } catch (error) {
                setCardStatus('stats-card', 'error');
                setResult('stats-result', `âŒ Erro: ${error.message}`, true);
            }
        }
        
        function testPomodoroSound() {
            setCardStatus('audio-card', 'loading');
            setResult('audio-result', 'ğŸ”Š Testando sistema de Ã¡udio...');
            
            try {
                // Simular o sistema de Ã¡udio do TimerSystem
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                masterGain.gain.setValueAtTime(0.3, audioContext.currentTime);

                const playTone = (frequency, startTime, duration, volume = 0.18) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();

                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(frequency, startTime);
                    osc.connect(gain);
                    gain.connect(masterGain);

                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(volume, startTime + 0.15);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);

                    osc.start(startTime);
                    osc.stop(startTime + duration);
                };

                const now = audioContext.currentTime;
                playTone(523.25, now, 1.2, 0.18);         // DÃ³
                playTone(659.25, now + 0.3, 1.4, 0.15);   // Mi
                playTone(783.99, now + 0.6, 1.0, 0.12);   // Sol
                
                console.log('ğŸ”Š Som do Pomodoro reproduzido com sucesso');
                setCardStatus('audio-card', 'success');
                setResult('audio-result', 
                    `ğŸµ Som reproduzido com sucesso!<br>
                    ğŸ¼ 3 tons harmÃ´nicos<br>
                    â±ï¸ DuraÃ§Ã£o: ~1.6 segundos`
                );
                
            } catch (error) {
                console.log(`âŒ Erro no Ã¡udio:`, error.message);
                setCardStatus('audio-card', 'error');
                setResult('audio-result', 
                    `âŒ Web Audio API nÃ£o suportada<br>
                    ğŸ’¡ Teste em navegador compatÃ­vel`, true
                );
            }
        }
        
        // Log inicial
        console.log('ğŸš€ PÃ¡gina de teste dos endpoints carregada');
        console.log('ğŸ”§ VersÃ£o da correÃ§Ã£o: 1.0.0');
        console.log('ğŸ“… Data: ' + new Date().toLocaleString('pt-BR'));
    </script>
</body>
</html>