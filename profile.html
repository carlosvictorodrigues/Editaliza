    <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - Editaliza</title>
    
    <!-- Favicon and Web App Icons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0528f2">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/design-tokens.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/footer.css" rel="stylesheet">
    <!-- Theme system removed - light mode only -->
    <!-- SCRIPTS CENTRALIZADOS -->
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .avatar-gallery-tab.active {
            border-color: #0528f2;
            background-color: #e0e7ff;
            color: #0528f2;
        }
        .avatar-item {
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .avatar-item:hover {
            transform: scale(1.05);
            border-color: #6366f1;
        }
        .avatar-item.selected {
            border-color: #0528f2;
            box-shadow: 0 0 0 3px rgba(5, 40, 242, 0.3);
        }
        
        #avatar-gallery {
            min-height: 120px;
        }
        
        .avatar-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .avatar-error {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .avatar-success {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #0528f2;
            box-shadow: 0 0 0 3px rgba(5, 40, 242, 0.1);
        }
        
        .form-input:disabled, .form-input[readonly] {
            background-color: #f8fafc;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-secondary:hover {
            background: #f9fafb;
            border-color: #d1d5db;
            color: #374151;
        }
        
        .section-collapsed {
            opacity: 0.7;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            max-width: 200px;
            white-space: normal;
            text-align: center;
        }
        
        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(1px);
            border: 5px solid transparent;
            border-top-color: #1f2937;
            z-index: 1000;
        }
        
        .profile-completion-indicator {
            background: linear-gradient(90deg, #10b981 var(--progress), #e5e7eb var(--progress));
            height: 4px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .section-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10;
            margin: -8px -8px 24px -8px;
            padding: 8px;
            border-radius: 16px;
        }
        
        @media (max-width: 640px) {
            .grid.grid-cols-1.sm\:grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .tooltip:hover::after {
                left: 20px;
                transform: none;
                max-width: calc(100vw - 40px);
            }
            
            .tooltip:hover::before {
                left: 30px;
                transform: none;
            }
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 relative overflow-x-hidden">
    <!-- NAVEGA√á√ÉO PRINCIPAL -->
    <div id="main-nav-container"></div>

    <main class="relative z-10 container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <div class="glass-card p-8 rounded-3xl mb-8">
            <div class="text-center">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-float">
                    <img id="profilePhoto" src="" alt="Foto do perfil" class="w-full h-full object-cover rounded-full hidden">
                    <svg id="defaultAvatar" class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold motivation-text mb-3">Meu Perfil</h1>
                <p class="text-gray-600 text-lg mb-2">Complete seu perfil para uma experi√™ncia personalizada de estudos</p>
                <p class="text-sm text-blue-600 bg-blue-50 rounded-lg p-3 max-w-2xl mx-auto">
                    üí° <strong>Por que essas informa√ß√µes s√£o importantes?</strong><br>
                    Cada dado que voc√™ compartilha nos ajuda a criar um plano de estudos √∫nico para voc√™, sugerir conte√∫dos relevantes e acompanhar seu progresso rumo √† aprova√ß√£o!
                </p>
                <div class="mt-4">
                    <div class="mb-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm text-gray-600">Progresso do Perfil</span>
                            <span id="progressText" class="text-sm font-medium text-blue-600">0%</span>
                        </div>
                        <div class="profile-completion-indicator" id="progressBar" style="--progress: 0%"></div>
                    </div>
                    <div class="flex flex-wrap gap-2 justify-center">
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">Dados Pessoais</span>
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Experi√™ncia</span>
                        <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">Objetivos</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2">
                <div class="space-y-6">
                    <!-- Se√ß√£o 1: Dados Pessoais -->
                    <div class="content-card">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">Dados Pessoais</h2>
                            <button type="button" id="personalToggle" class="text-blue-600 hover:text-blue-800 font-medium">
                                <svg class="w-5 h-5 inline transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-green-800">Como seus dados pessoais te ajudam</h3>
                                    <div class="mt-2 text-sm text-green-700">
                                        <p>üìç <strong>Localiza√ß√£o:</strong> Sugerimos concursos na sua regi√£o e oportunidades pr√≥ximas</p>
                                        <p>üéì <strong>Escolaridade:</strong> Filtramos apenas concursos compat√≠veis com seu n√≠vel</p>
                                        <p>üíº <strong>Situa√ß√£o profissional:</strong> Criamos cronogramas realistas baseados no seu tempo dispon√≠vel</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="personalSection" class="space-y-6">
                            <form id="profileForm" class="space-y-6">
                                <div>
                                    <label for="name" class="block text-sm font-semibold text-gray-700 mb-1">Nome Completo</label>
                                    <p class="text-xs text-gray-500 mb-2">üí´ Seu nome aparecer√° nas suas conquistas e certificados personalizados</p>
                                    <input type="text" id="name" name="name" class="form-input" placeholder="Digite seu nome completo">
                                </div>

                                <div>
                                    <label for="email" class="block text-sm font-semibold text-gray-700 mb-1">E-mail</label>
                                    <p class="text-xs text-gray-500 mb-2">üìß Usado para notifica√ß√µes importantes e atualiza√ß√µes sobre concursos</p>
                                    <input type="email" id="email" name="email" class="form-input bg-gray-50" readonly>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="state" class="block text-sm font-semibold text-gray-700 mb-1">Estado</label>
                                        <p class="text-xs text-gray-500 mb-2">üåé Priorizamos concursos e oportunidades na sua regi√£o</p>
                                        <select id="state" name="state" class="form-input">
                                            <option value="">Selecione seu estado</option>
                                            <option value="AC">Acre (AC)</option>
                                            <option value="AL">Alagoas (AL)</option>
                                            <option value="AP">Amap√° (AP)</option>
                                            <option value="AM">Amazonas (AM)</option>
                                            <option value="BA">Bahia (BA)</option>
                                            <option value="CE">Cear√° (CE)</option>
                                            <option value="DF">Distrito Federal (DF)</option>
                                            <option value="ES">Esp√≠rito Santo (ES)</option>
                                            <option value="GO">Goi√°s (GO)</option>
                                            <option value="MA">Maranh√£o (MA)</option>
                                            <option value="MT">Mato Grosso (MT)</option>
                                            <option value="MS">Mato Grosso do Sul (MS)</option>
                                            <option value="MG">Minas Gerais (MG)</option>
                                            <option value="PA">Par√° (PA)</option>
                                            <option value="PB">Para√≠ba (PB)</option>
                                            <option value="PR">Paran√° (PR)</option>
                                            <option value="PE">Pernambuco (PE)</option>
                                            <option value="PI">Piau√≠ (PI)</option>
                                            <option value="RJ">Rio de Janeiro (RJ)</option>
                                            <option value="RN">Rio Grande do Norte (RN)</option>
                                            <option value="RS">Rio Grande do Sul (RS)</option>
                                            <option value="RO">Rond√¥nia (RO)</option>
                                            <option value="RR">Roraima (RR)</option>
                                            <option value="SC">Santa Catarina (SC)</option>
                                            <option value="SP">S√£o Paulo (SP)</option>
                                            <option value="SE">Sergipe (SE)</option>
                                            <option value="TO">Tocantins (TO)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="city" class="block text-sm font-semibold text-gray-700 mb-1">Cidade</label>
                                        <p class="text-xs text-gray-500 mb-2">üèôÔ∏è Para sugerir locais de prova e vagas espec√≠ficas da sua cidade</p>
                                        <input type="text" id="city" name="city" class="form-input" placeholder="Digite sua cidade">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="birthDate" class="block text-sm font-semibold text-gray-700 mb-1">Data de Nascimento</label>
                                        <p class="text-xs text-gray-500 mb-2">üìÖ Alguns concursos t√™m limite de idade - garantimos que voc√™ veja apenas oportunidades adequadas</p>
                                        <input type="date" id="birthDate" name="birthDate" class="form-input">
                                    </div>
                                    <div>
                                        <label for="education" class="block text-sm font-semibold text-gray-700 mb-1">N√≠vel de Escolaridade</label>
                                        <p class="text-xs text-gray-500 mb-2">üéì Filtramos concursos compat√≠veis com sua forma√ß√£o e sugerimos √°reas promissoras</p>
                                        <select id="education" name="education" class="form-input">
                                            <option value="">Selecione sua escolaridade</option>
                                            <option value="fundamental">Ensino Fundamental</option>
                                            <option value="medio">Ensino M√©dio</option>
                                            <option value="tecnico">T√©cnico</option>
                                            <option value="superior-incompleto">Superior Incompleto</option>
                                            <option value="superior-completo">Superior Completo</option>
                                            <option value="pos-graduacao">P√≥s-gradua√ß√£o</option>
                                            <option value="mestrado">Mestrado</option>
                                            <option value="doutorado">Doutorado</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label for="workStatus" class="block text-sm font-semibold text-gray-700 mb-1">Situa√ß√£o Profissional</label>
                                    <p class="text-xs text-gray-500 mb-2">üíº Adaptamos seus cronogramas baseado no tempo dispon√≠vel para estudos</p>
                                    <select id="workStatus" name="workStatus" class="form-input">
                                        <option value="">Selecione sua situa√ß√£o</option>
                                        <option value="desempregado">Desempregado(a)</option>
                                        <option value="empregado-privado">Empregado(a) - Setor Privado</option>
                                        <option value="empregado-publico">Empregado(a) - Setor P√∫blico</option>
                                        <option value="autonomo">Aut√¥nomo(a)</option>
                                        <option value="empresario">Empres√°rio(a)</option>
                                        <option value="estudante">Estudante</option>
                                        <option value="aposentado">Aposentado(a)</option>
                                    </select>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="phone" class="block text-sm font-semibold text-gray-700 mb-1">Telefone</label>
                                        <p class="text-xs text-gray-500 mb-2">üìû Para contato em emerg√™ncias e informa√ß√µes urgentes sobre editais</p>
                                        <input type="tel" id="phone" name="phone" class="form-input" placeholder="(11) 99999-9999">
                                    </div>
                                    <div>
                                        <label for="whatsapp" class="block text-sm font-semibold text-gray-700 mb-1">WhatsApp</label>
                                        <p class="text-xs text-gray-500 mb-2">üì± Para receber lembretes importantes e dicas de estudo (opcional)</p>
                                        <input type="tel" id="whatsapp" name="whatsapp" class="form-input" placeholder="(11) 99999-9999">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Se√ß√£o 2: Experi√™ncia em Concursos -->
                    <div class="content-card">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">Experi√™ncia em Concursos</h2>
                            <button type="button" id="experienceToggle" class="text-blue-600 hover:text-blue-800 font-medium">
                                <svg class="w-5 h-5 inline transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="bg-purple-50 border-l-4 border-purple-400 p-4 mb-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-purple-800">Como sua experi√™ncia nos orienta</h3>
                                    <div class="mt-2 text-sm text-purple-700">
                                        <p>üöÄ <strong>Primeira vez:</strong> Oferecemos guias especiais para iniciantes e dicas fundamentais</p>
                                        <p>üìà <strong>J√° tentou antes:</strong> Focamos em estrat√©gias avan√ßadas e supera√ß√£o de obst√°culos espec√≠ficos</p>
                                        <p>üéØ <strong>Suas dificuldades:</strong> Personalizamos o conte√∫do para fortalecer seus pontos fracos</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="experienceSection" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">√â sua primeira vez estudando para concursos?</label>
                                <p class="text-xs text-gray-500 mb-3">‚ú® Definimos o n√≠vel de orienta√ß√£o e suporte que voc√™ precisa</p>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="firstTime" value="sim" class="mr-3 text-blue-600">
                                        <span>Sim, √© minha primeira vez</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="firstTime" value="nao" class="mr-3 text-blue-600">
                                        <span>N√£o, j√° estudei antes</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label for="concursosCount" class="block text-sm font-semibold text-gray-700 mb-1">Quantos concursos j√° prestou?</label>
                                <p class="text-xs text-gray-500 mb-2">üìä Ajustamos as estrat√©gias baseadas na sua experi√™ncia pr√°tica</p>
                                <select id="concursosCount" name="concursosCount" class="form-input">
                                    <option value="">Selecione</option>
                                    <option value="0">Nenhum ainda</option>
                                    <option value="1-3">1 a 3 concursos</option>
                                    <option value="4-10">4 a 10 concursos</option>
                                    <option value="11-20">11 a 20 concursos</option>
                                    <option value="20+">Mais de 20 concursos</option>
                                </select>
                            </div>

                            <div>
                                <label for="difficulties" class="block text-sm font-semibold text-gray-700 mb-1">Principais dificuldades (opcional)</label>
                                <p class="text-xs text-gray-500 mb-3">üéØ Identificamos seus desafios para oferecer solu√ß√µes e conte√∫do espec√≠fico</p>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="organizacao" class="mr-3 text-blue-600">
                                        <span>Organiza√ß√£o dos estudos</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="motivacao" class="mr-3 text-blue-600">
                                        <span>Manter a motiva√ß√£o</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="tempo" class="mr-3 text-blue-600">
                                        <span>Falta de tempo</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="disciplina" class="mr-3 text-blue-600">
                                        <span>Disciplina nos estudos</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="materias" class="mr-3 text-blue-600">
                                        <span>Dificuldade em mat√©rias espec√≠ficas</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="difficulties" value="ansiedade" class="mr-3 text-blue-600">
                                        <span>Ansiedade na prova</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Se√ß√£o 3: Metas e Objetivos -->
                    <div class="content-card">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">Metas e Objetivos</h2>
                            <button type="button" id="goalsToggle" class="text-blue-600 hover:text-blue-800 font-medium">
                                <svg class="w-5 h-5 inline transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-blue-800">Seus objetivos direcionam tudo</h3>
                                    <div class="mt-2 text-sm text-blue-700">
                                        <p>üéØ <strong>√Årea de interesse:</strong> Sugerimos concursos espec√≠ficos e conte√∫do direcionado</p>
                                        <p>‚è∞ <strong>Cronograma:</strong> Criamos planos de estudo realistas baseados no seu prazo</p>
                                        <p>üí™ <strong>Motiva√ß√£o:</strong> Personalizamos mensagens inspiradoras com base nos seus sonhos</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="goalsSection" class="space-y-6">
                            <div>
                                <label for="areaInterest" class="block text-sm font-semibold text-gray-700 mb-1">√Årea de Interesse Principal</label>
                                <p class="text-xs text-gray-500 mb-2">üéØ Direcionamos todo conte√∫do e sugest√µes para sua √°rea de interesse</p>
                                <select id="areaInterest" name="areaInterest" class="form-input">
                                    <option value="">Selecione uma √°rea</option>
                                    <option value="administrativo">√Årea Administrativa</option>
                                    <option value="fiscal">√Årea Fiscal</option>
                                    <option value="policial">√Årea Policial</option>
                                    <option value="juridica">√Årea Jur√≠dica</option>
                                    <option value="saude">√Årea da Sa√∫de</option>
                                    <option value="educacao">√Årea da Educa√ß√£o</option>
                                    <option value="engenharia">Engenharia</option>
                                    <option value="ti">Tecnologia da Informa√ß√£o</option>
                                    <option value="bancaria">√Årea Banc√°ria</option>
                                    <option value="legislativo">Poder Legislativo</option>
                                    <option value="judiciario">Poder Judici√°rio</option>
                                    <option value="outros">Outras √°reas</option>
                                </select>
                            </div>

                            <div>
                                <label for="levelDesired" class="block text-sm font-semibold text-gray-700 mb-1">N√≠vel Desejado</label>
                                <p class="text-xs text-gray-500 mb-2">üìà Filtramos oportunidades com sal√°rios e responsabilidades adequadas ao n√≠vel desejado</p>
                                <select id="levelDesired" name="levelDesired" class="form-input">
                                    <option value="">Selecione o n√≠vel</option>
                                    <option value="fundamental">N√≠vel Fundamental</option>
                                    <option value="medio">N√≠vel M√©dio</option>
                                    <option value="tecnico">N√≠vel T√©cnico</option>
                                    <option value="superior">N√≠vel Superior</option>
                                    <option value="qualquer">Qualquer n√≠vel</option>
                                </select>
                            </div>

                            <div>
                                <label for="timelineGoal" class="block text-sm font-semibold text-gray-700 mb-1">Prazo para Aprova√ß√£o</label>
                                <p class="text-xs text-gray-500 mb-2">‚è≥ Criamos cronogramas realistas e intensidade de estudos adequada ao seu objetivo</p>
                                <select id="timelineGoal" name="timelineGoal" class="form-input">
                                    <option value="">Selecione um prazo</option>
                                    <option value="6-meses">At√© 6 meses</option>
                                    <option value="1-ano">At√© 1 ano</option>
                                    <option value="2-anos">At√© 2 anos</option>
                                    <option value="3-anos">At√© 3 anos</option>
                                    <option value="sem-pressa">Sem pressa definida</option>
                                </select>
                            </div>

                            <div>
                                <label for="studyHours" class="block text-sm font-semibold text-gray-700 mb-1">Quantas horas por dia voc√™ consegue estudar?</label>
                                <p class="text-xs text-gray-500 mb-2">üìö Distribu√≠mos o conte√∫do de forma equilibrada respeitando seu tempo dispon√≠vel</p>
                                <select id="studyHours" name="studyHours" class="form-input">
                                    <option value="">Selecione</option>
                                    <option value="1-2">1 a 2 horas</option>
                                    <option value="3-4">3 a 4 horas</option>
                                    <option value="5-6">5 a 6 horas</option>
                                    <option value="7-8">7 a 8 horas</option>
                                    <option value="8+">Mais de 8 horas</option>
                                </select>
                            </div>

                            <div>
                                <label for="motivationText" class="block text-sm font-semibold text-gray-700 mb-1">O que te motiva a ser servidor p√∫blico? (opcional)</label>
                                <p class="text-xs text-gray-500 mb-2">üí´ Personalizamos mensagens inspiradoras conectadas aos seus sonhos e objetivos pessoais</p>
                                <textarea id="motivationText" name="motivationText" rows="3" class="form-input" placeholder="Ex: Busco estabilidade para minha fam√≠lia, quero servir √† sociedade, desejo fazer a diferen√ßa na educa√ß√£o p√∫blica..."></textarea>
                                <p class="text-xs text-blue-600 mt-1">üí° Dica: Quanto mais espec√≠fico, mais personalizadas ser√£o suas mensagens motivacionais di√°rias!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√£o Salvar -->
                    <div class="content-card">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <svg class="h-5 w-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <p class="text-sm text-green-700">
                                    <strong>Pronto para come√ßar?</strong> Salve suas informa√ß√µes e transforme seus dados em um plano de estudos personalizado!
                                </p>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button type="submit" id="saveBtn" form="profileForm" class="btn-primary flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Salvar e Personalizar Minha Experi√™ncia
                            </button>
                            <button type="button" id="resetBtn" class="btn-secondary">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Restaurar Dados Originais
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="content-card">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">
                        <svg class="w-5 h-5 inline mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Escolha seu Avatar
                    </h3>
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 mb-4">
                        <p class="text-sm text-indigo-700">
                            üé® <strong>Sua identidade visual:</strong> Seu avatar aparece em conquistas, rankings e intera√ß√µes na plataforma, tornando sua jornada mais pessoal e motivadora!
                        </p>
                    </div>
                    <div id="avatar-selection-ui"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let originalData = {};
        let selectedAvatarPath = null;

        const defaultAvatarCatalog = {
            adventurer: [
                'avatar1.svg',
                'avatar2.svg',
                'avatar3.svg',
                'avatar4.svg',
                'avatar5.svg',
                'avatar6.svg'
            ],
            'pixel-art': [
                'pixel1.svg',
                'pixel2.svg',
                'pixel3.svg',
                'pixel4.svg',
                'pixel5.svg',
                'pixel6.svg'
            ],
            bots: [
                'bot1.svg',
                'bot2.svg',
                'bot3.svg',
                'bot4.svg',
                'bot5.svg',
                'bot6.svg'
            ],
            miniavs: [
                'miniav1.svg',
                'miniav2.svg',
                'miniav3.svg',
                'miniav4.svg',
                'miniav5.svg',
                'miniav6.svg'
            ],
            classic: [
                '1.svg',
                '2.svg',
                '3.svg',
                '4.svg',
                '5.svg',
                '6.svg',
                '7.svg',
                '8.svg',
                '9.svg',
                '10.svg',
                '11.svg',
                'avatar-svgrepo-com.svg',
                'avatar-svgrepo-com (1).svg',
                'avatar-svgrepo-com (2).svg',
                'avatar-svgrepo-com (3).svg',
                'avatar-svgrepo-com (4).svg',
                'avatar-svgrepo-com (5).svg'
            ],
            christmas: [
                'avatar-winter-custome-5-svgrepo-com.svg',
                'avatar-winter-custome-14-svgrepo-com.svg',
                'avatar-winter-custome-24-svgrepo-com.svg',
                'avatar-winter-custome-35-svgrepo-com.svg',
                'avatar-winter-custome-37-svgrepo-com.svg',
                'avatar-winter-custome-47-svgrepo-com.svg'
            ]
        };

        const labelMap = {
            adventurer: 'Aventureiros',
            'pixel-art': 'Pixel Art',
            bots: 'Bots',
            miniavs: 'Minimalista',
            classic: 'Cl√°ssico',
            christmas: 'Natalino'
        };

        const avatarCatalog = window.avatarCatalog || defaultAvatarCatalog;
        const avatarCategories = Object.fromEntries(
            Object.entries(avatarCatalog).map(([key, files]) => [key, {
                label: labelMap[key] || key,
                files
            }])
        );

        async function initialize() {
            try {
                await components.renderMainNavigation('profile.html');
                await loadProfileData();
                renderAvatarUI();
                setupFormEvents();
                setupTooltips();
                updateProgressBar();
                showProfileCompletionTips();
                console.log('‚úÖ P√°gina de perfil inicializada com sucesso!');
                console.log('üéØ Estado inicial do avatar:', selectedAvatarPath);
            } catch (error) {
                console.error("‚ùå Erro na inicializa√ß√£o da p√°gina de perfil:", error);
                app.showToast('Erro fatal ao carregar a p√°gina. Tente novamente.', 'error');
            }
        }

        async function loadProfileData() {
            try {
                console.log('üì• Carregando dados do perfil...');
                app.showSpinner();
                const profile = await app.apiFetch('/users/profile');
                console.log('üìã Dados do perfil recebidos:', profile);
                
                // Dados pessoais b√°sicos
                document.getElementById('name').value = profile.name || '';
                document.getElementById('email').value = profile.email || '';
                document.getElementById('phone').value = profile.phone || '';
                document.getElementById('whatsapp').value = profile.whatsapp || '';
                
                // Novos dados pessoais
                document.getElementById('state').value = profile.state || '';
                document.getElementById('city').value = profile.city || '';
                document.getElementById('birthDate').value = profile.birth_date || '';
                document.getElementById('education').value = profile.education || '';
                document.getElementById('workStatus').value = profile.work_status || '';
                
                // Experi√™ncia em concursos
                if (profile.first_time) {
                    const radio = document.querySelector(`input[name="firstTime"][value="${profile.first_time}"]`);
                    if (radio) radio.checked = true;
                }
                document.getElementById('concursosCount').value = profile.concursos_count || '';
                
                // Dificuldades (array)
                if (profile.difficulties && Array.isArray(profile.difficulties)) {
                    profile.difficulties.forEach(difficulty => {
                        const checkbox = document.querySelector(`input[name="difficulties"][value="${difficulty}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                // Metas e objetivos
                document.getElementById('areaInterest').value = profile.area_interest || '';
                document.getElementById('levelDesired').value = profile.level_desired || '';
                document.getElementById('timelineGoal').value = profile.timeline_goal || '';
                document.getElementById('studyHours').value = profile.study_hours || '';
                document.getElementById('motivationText').value = profile.motivation_text || '';
                
                // Check if user has Google avatar or local avatar
                console.log('üñºÔ∏è Carregando avatar do perfil:');
                console.log('  - profile.google_avatar:', profile.google_avatar);
                console.log('  - profile.auth_provider:', profile.auth_provider);
                console.log('  - profile.profile_picture:', profile.profile_picture);
                
                if (profile.google_avatar && profile.auth_provider === 'google') {
                    selectedAvatarPath = profile.google_avatar;
                    console.log('üåê Usando avatar do Google:', selectedAvatarPath);
                } else {
                    selectedAvatarPath = profile.profile_picture;
                    console.log('üíæ Usando avatar local:', selectedAvatarPath);
                }
                
                console.log('üéØ Avatar final selecionado:', selectedAvatarPath);
                updateProfilePhoto(selectedAvatarPath);
                
                // Atualizar dados originais para compara√ß√£o
                originalData = {
                    name: profile.name || '',
                    phone: profile.phone || '',
                    whatsapp: profile.whatsapp || '',
                    state: profile.state || '',
                    city: profile.city || '',
                    birth_date: profile.birth_date || '',
                    education: profile.education || '',
                    work_status: profile.work_status || '',
                    first_time: profile.first_time || '',
                    concursos_count: profile.concursos_count || '',
                    difficulties: profile.difficulties || [],
                    area_interest: profile.area_interest || '',
                    level_desired: profile.level_desired || '',
                    timeline_goal: profile.timeline_goal || '',
                    study_hours: profile.study_hours || '',
                    motivation_text: profile.motivation_text || '',
                    profile_picture: profile.profile_picture || null
                };
                
                console.log('üìù Dados originais configurados:', originalData);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados do perfil:', error);
                app.showToast('Erro ao carregar dados do perfil.', 'error');
            } finally {
                console.log('üèÅ Finalizando carregamento dos dados do perfil...');
                app.hideSpinner();
            }
        }

        function updateProfilePhoto(path) {
            const profilePhoto = document.getElementById('profilePhoto');
            const defaultAvatar = document.getElementById('defaultAvatar');
            
            if (!profilePhoto || !defaultAvatar) {
                console.error('‚ùå Elementos de foto do perfil n√£o encontrados');
                return;
            }
            
            if (path) {
                console.log('üìÅ Caminho do avatar:', path);
                console.log('üîç Tipo de avatar:', path.startsWith('https://') ? 'Google' : 'Local');
                
                // Check if it's a Google avatar (starts with https://)
                if (path.startsWith('https://')) {
                    // Google avatar - use directly without cache buster
                    console.log('üåê Usando avatar do Google:', path);
                    profilePhoto.src = path;
                } else {
                    // Local avatar - add cache buster to avoid caching issues
                    const cacheBuster = '?t=' + new Date().getTime();
                    const finalPath = path.startsWith('./') ? path + cacheBuster : './' + path + cacheBuster;
                    console.log('üíæ Usando avatar local com cache buster:', finalPath);
                    profilePhoto.src = finalPath;
                }
                
                // Handle load success
                profilePhoto.addEventListener('load', () => {
                    profilePhoto.classList.remove('hidden');
                    defaultAvatar.classList.add('hidden');
                }, { once: true });
                
                // Handle load error
                profilePhoto.addEventListener('error', () => {
                    console.error('‚ùå Erro ao carregar foto do perfil:', path);
                    profilePhoto.classList.add('hidden');
                    defaultAvatar.classList.remove('hidden');
                }, { once: true });
            } else {
                console.log('üö´ Nenhum avatar definido, mostrando avatar padr√£o');
                profilePhoto.classList.add('hidden');
                defaultAvatar.classList.remove('hidden');
            }
        }

        function renderAvatarUI() {
            console.log('üé® Renderizando interface de sele√ß√£o de avatar...');
            console.log('üéØ Avatar atualmente selecionado:', selectedAvatarPath);
            
            const container = document.getElementById('avatar-selection-ui');
            const tabs = Object.entries(avatarCategories).map(([key, data]) =>
                `<button class="avatar-gallery-tab px-4 py-2 text-sm font-semibold rounded-lg border transition-colors" data-category="${key}">${data.label}</button>`
            ).join('');

            // Check if user is Google user
            const isGoogleUser = selectedAvatarPath && selectedAvatarPath.startsWith('https://');
            console.log('üåê Usu√°rio do Google:', isGoogleUser);
            
            const googleNotice = isGoogleUser ? 
                `<div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                    <p class="text-sm text-blue-700">
                        üîó <strong>Avatar do Google:</strong> Voc√™ est√° usando sua foto do Google. Para usar um avatar personalizado, selecione uma op√ß√£o abaixo.
                    </p>
                </div>` : '';
            
            container.innerHTML = `
                ${googleNotice}
                <div class="flex flex-wrap gap-2 mb-4">${tabs}</div>
                <div id="avatar-gallery" class="grid grid-cols-4 gap-4"></div>
            `;

            const tabButtons = container.querySelectorAll('.avatar-gallery-tab');
            console.log('üîò Abas de avatar encontradas:', tabButtons.length);
            
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('üîò Aba clicada:', btn.dataset.category);
                    tabButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderAvatarGallery(btn.dataset.category);
                });
            });

            // Load first category by default
            if (tabButtons.length > 0) {
                console.log('üîÑ Carregando primeira categoria por padr√£o...');
                tabButtons[0].click();
            } else {
                console.warn('‚ö†Ô∏è Nenhuma aba de avatar encontrada');
            }
        }

        function renderAvatarGallery(category) {
            const gallery = document.getElementById('avatar-gallery');
            if (!gallery) {
                console.error('‚ùå Elemento avatar-gallery n√£o encontrado');
                return;
            }
            gallery.innerHTML = '';

            const files = avatarCategories[category]?.files || [];
            files.forEach(file => {
                const avatarPath = `images/avatars/${category}/${file}`;

                const avatarContainer = document.createElement('div');
                avatarContainer.className = 'relative';

                const img = document.createElement('img');
                img.src = avatarPath;
                img.className = `avatar-item rounded-full p-1 bg-gray-100 w-16 h-16 object-cover`;
                img.alt = `Avatar ${file}`;

                // Loading placeholder
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'w-16 h-16 rounded-full bg-gray-200 animate-pulse flex items-center justify-center';
                loadingDiv.innerHTML = '<span class="text-xs text-gray-400">...</span>';

                // Error placeholder
                const errorDiv = document.createElement('div');
                errorDiv.className = 'w-16 h-16 rounded-full bg-red-100 border-2 border-red-300 hidden flex items-center justify-center';
                errorDiv.innerHTML = '<span class="text-xs text-red-500">‚ùå</span>';

                if (avatarPath === selectedAvatarPath) {
                    img.classList.add('selected');
                }

                img.addEventListener('load', () => {
                    loadingDiv.style.display = 'none';
                    img.style.display = 'block';
                    
                    // Verificar se este avatar est√° selecionado
                    if (avatarPath === selectedAvatarPath) {
                        console.log(`üéØ Avatar j√° selecionado: ${avatarPath}`);
                        img.classList.add('selected');
                    }
                });

                img.addEventListener('error', () => {
                    loadingDiv.style.display = 'none';
                    img.style.display = 'none';
                    errorDiv.classList.remove('hidden');
                    errorDiv.classList.add('flex');
                    errorDiv.title = `Erro: ${file} n√£o encontrado`;
                });

                // Initially hide image and show loading
                img.style.display = 'none';

                img.addEventListener('click', () => {
                    if (img.style.display !== 'none') {
                        console.log('üñ±Ô∏è Avatar clicado:', avatarPath);
                        console.log('  - Avatar anterior:', selectedAvatarPath);
                        
                        document.querySelectorAll('.avatar-item.selected').forEach(el => el.classList.remove('selected'));
                        img.classList.add('selected');
                        selectedAvatarPath = avatarPath;
                        
                        console.log('  - Novo avatar selecionado:', selectedAvatarPath);
                        console.log('  - Bot√£o de salvar ser√° habilitado');
                        
                        document.getElementById('saveBtn').disabled = false;
                        console.log('üéØ Avatar selecionado:', avatarPath);
                        
                        // Verificar mudan√ßas para habilitar o bot√£o de salvar
                        if (typeof checkForChanges === 'function') {
                            console.log('üîç Chamando checkForChanges...');
                            checkForChanges();
                        } else {
                            console.warn('‚ö†Ô∏è Fun√ß√£o checkForChanges n√£o encontrada');
                        }
                    }
                });

                avatarContainer.appendChild(loadingDiv);
                avatarContainer.appendChild(img);
                avatarContainer.appendChild(errorDiv);
                gallery.appendChild(avatarContainer);
            });
        }

        function setupFormEvents() {
            const form = document.getElementById('profileForm');
            const saveBtn = document.getElementById('saveBtn');
            const resetBtn = document.getElementById('resetBtn');
            
            // Todos os campos do formul√°rio
            const formFields = [
                'name', 'phone', 'whatsapp', 'state', 'city', 'birthDate', 
                'education', 'workStatus', 'concursosCount', 'areaInterest', 
                'levelDesired', 'timelineGoal', 'studyHours', 'motivationText'
            ];
            
            function checkForChanges() {
                console.log('üîç Verificando mudan√ßas no formul√°rio...');
                let hasChanges = false;
                
                // Verificar campos de input e select
                formFields.forEach(fieldName => {
                    const element = document.getElementById(fieldName);
                    if (element) {
                        const currentValue = element.value.trim();
                        const originalValue = originalData[fieldName === 'birthDate' ? 'birth_date' : 
                                                      fieldName === 'workStatus' ? 'work_status' :
                                                      fieldName === 'concursosCount' ? 'concursos_count' :
                                                      fieldName === 'areaInterest' ? 'area_interest' :
                                                      fieldName === 'levelDesired' ? 'level_desired' :
                                                      fieldName === 'timelineGoal' ? 'timeline_goal' :
                                                      fieldName === 'studyHours' ? 'study_hours' :
                                                      fieldName === 'motivationText' ? 'motivation_text' :
                                                      fieldName] || '';
                        if (currentValue !== originalValue) {
                            hasChanges = true;
                        }
                    }
                });
                
                // Verificar radio buttons
                const firstTimeRadio = document.querySelector('input[name="firstTime"]:checked');
                const firstTimeValue = firstTimeRadio ? firstTimeRadio.value : '';
                if (firstTimeValue !== (originalData.first_time || '')) {
                    hasChanges = true;
                }
                
                // Verificar checkboxes
                const selectedDifficulties = Array.from(document.querySelectorAll('input[name="difficulties"]:checked')).map(cb => cb.value);
                const originalDifficulties = originalData.difficulties || [];
                if (JSON.stringify(selectedDifficulties.sort()) !== JSON.stringify(originalDifficulties.sort())) {
                    hasChanges = true;
                }
                
                // Verificar avatar
                console.log('üîç Verificando mudan√ßas no avatar:');
                console.log('  - selectedAvatarPath:', selectedAvatarPath);
                console.log('  - originalData.profile_picture:', originalData.profile_picture);
                console.log('  - S√£o diferentes?', selectedAvatarPath !== originalData.profile_picture);
                
                if (selectedAvatarPath !== originalData.profile_picture) {
                    hasChanges = true;
                    console.log('‚úÖ Mudan√ßa detectada no avatar');
                }
                
                console.log('üìä Resumo das mudan√ßas:');
                console.log('  - hasChanges:', hasChanges);
                console.log('  - Bot√£o de salvar ser√°:', hasChanges ? 'habilitado' : 'desabilitado');
                
                saveBtn.disabled = !hasChanges;
                updateProgressBar();
            }
            
            // Adicionar event listeners
            formFields.forEach(fieldName => {
                const element = document.getElementById(fieldName);
                if (element) {
                    element.addEventListener('input', checkForChanges);
                    element.addEventListener('change', checkForChanges);
                }
            });
            
            // Radio buttons e checkboxes
            document.querySelectorAll('input[name="firstTime"]').forEach(radio => {
                radio.addEventListener('change', checkForChanges);
            });
            
            document.querySelectorAll('input[name="difficulties"]').forEach(checkbox => {
                checkbox.addEventListener('change', checkForChanges);
            });
            
            // Form submit
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveProfile();
            });
            
            // Reset button
            resetBtn.addEventListener('click', () => {
                if (confirm('Tem certeza que deseja restaurar todos os dados para os valores originais?')) {
                    loadProfileData();
                }
            });
            
            // Setup section toggles
            setupSectionToggles();
        }
        
        async function saveProfile() {
            console.log('üíæ Iniciando salvamento do perfil...');
            console.log('üéØ Avatar selecionado antes de salvar:', selectedAvatarPath);
            
            const saveBtn = document.getElementById('saveBtn');
            
            // Coletar dados do formul√°rio
            const selectedDifficulties = Array.from(document.querySelectorAll('input[name="difficulties"]:checked')).map(cb => cb.value);
            const firstTimeRadio = document.querySelector('input[name="firstTime"]:checked');
            
            // Fun√ß√£o helper para limpar strings vazias
            const cleanValue = (value) => {
                if (typeof value === 'string') {
                    const cleaned = value.trim();
                    return cleaned === '' ? null : cleaned;
                }
                return value || null;
            };
            
            const updateData = {
                // Dados pessoais b√°sicos
                name: cleanValue(document.getElementById('name').value),
                phone: cleanValue(document.getElementById('phone').value),
                whatsapp: cleanValue(document.getElementById('whatsapp').value),
                
                // Novos dados pessoais
                state: cleanValue(document.getElementById('state').value),
                city: cleanValue(document.getElementById('city').value),
                birth_date: cleanValue(document.getElementById('birthDate').value),
                education: cleanValue(document.getElementById('education').value),
                work_status: cleanValue(document.getElementById('workStatus').value),
                
                // Experi√™ncia em concursos
                first_time: firstTimeRadio ? firstTimeRadio.value : null,
                concursos_count: cleanValue(document.getElementById('concursosCount').value),
                difficulties: selectedDifficulties, // Sempre envia um array, mesmo que vazio
                
                // Metas e objetivos
                area_interest: cleanValue(document.getElementById('areaInterest').value),
                level_desired: cleanValue(document.getElementById('levelDesired').value),
                timeline_goal: cleanValue(document.getElementById('timelineGoal').value),
                study_hours: cleanValue(document.getElementById('studyHours').value),
                motivation_text: cleanValue(document.getElementById('motivationText').value),
                
                // Avatar
                profile_picture: selectedAvatarPath || null
            };
            
            console.log('üéØ Avatar selecionado para salvar:', selectedAvatarPath);
            console.log('üì∏ Campo profile_picture no updateData:', updateData.profile_picture);
            
            // Remover campos nulos/vazios para n√£o enviar dados desnecess√°rios
            Object.keys(updateData).forEach(key => {
                if (updateData[key] === null || updateData[key] === undefined) {
                    delete updateData[key];
                }
            });

            saveBtn.disabled = true;
            saveBtn.innerHTML = `
                <svg class="w-5 h-5 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Salvando...
            `;
            app.showSpinner();

            try {
                console.log('üíæ Enviando dados do perfil:', updateData);
                console.log('üì§ Dados sendo enviados para o servidor:', JSON.stringify(updateData, null, 2));
                
                const response = await app.apiFetch('/users/profile', {
                    method: 'PATCH',
                    body: JSON.stringify(updateData)
                });
                
                console.log('‚úÖ Perfil salvo com sucesso:', response);
                console.log('üì• Resposta do servidor:', JSON.stringify(response, null, 2));
                
                // Atualizar dados originais
                console.log('üìù Atualizando dados originais ap√≥s salvar:');
                console.log('  - originalData anterior:', originalData);
                console.log('  - updateData:', updateData);
                
                originalData = { ...originalData, ...updateData };
                console.log('  - originalData atualizado:', originalData);
                
                console.log('üñºÔ∏è Atualizando foto do perfil ap√≥s salvar:', selectedAvatarPath);
                updateProfilePhoto(selectedAvatarPath);
                
                // Atualizar avatar na navega√ß√£o
                if (typeof app.onUserAvatarUpdated === 'function') {
                    await app.onUserAvatarUpdated();
                }
                
                app.showToast('Perfil atualizado com sucesso! Suas informa√ß√µes ajudar√£o a personalizar sua experi√™ncia.', 'success');
                saveBtn.disabled = true;
                
                // Atualizar barra de progresso ap√≥s salvar
                updateProgressBar();
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar perfil:', error);
                console.error('üìã Detalhes do erro:', {
                    message: error.message,
                    stack: error.stack,
                    details: error.details
                });
                const errorMessage = error.message || 'Erro ao salvar perfil. Tente novamente.';
                app.showToast(errorMessage, 'error');
                saveBtn.disabled = false;
                
                // Se houver erros de valida√ß√£o, mostrar detalhes
                if (error.details && Array.isArray(error.details)) {
                    console.warn('Erros de valida√ß√£o:', error.details);
                    error.details.forEach(detail => {
                        console.warn('- ' + detail.msg + ' (campo: ' + detail.msg + ')');
                    });
                }
                
                // Log adicional para debug
                console.log('üîç Estado atual ap√≥s erro:');
                console.log('  - selectedAvatarPath:', selectedAvatarPath);
                console.log('  - originalData.profile_picture:', originalData.profile_picture);
            } finally {
                console.log('üèÅ Finalizando salvamento do perfil...');
                console.log('üéØ Estado final do avatar:', selectedAvatarPath);
                
                app.hideSpinner();
                saveBtn.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Salvar Todas as Informa√ß√µes
                `;
            }
        }
        
        function setupSectionToggles() {
            const toggles = [
                { button: 'personalToggle', section: 'personalSection' },
                { button: 'experienceToggle', section: 'experienceSection' },
                { button: 'goalsToggle', section: 'goalsSection' }
            ];
            
            toggles.forEach(({ button, section }) => {
                const toggleBtn = document.getElementById(button);
                const sectionEl = document.getElementById(section);
                const icon = toggleBtn.querySelector('svg');
                
                toggleBtn.addEventListener('click', () => {
                    const isHidden = sectionEl.style.display === 'none';
                    
                    if (isHidden) {
                        sectionEl.style.display = 'block';
                        icon.style.transform = 'rotate(0deg)';
                        // Smooth reveal animation
                        sectionEl.style.opacity = '0';
                        sectionEl.style.maxHeight = '0';
                        sectionEl.style.overflow = 'hidden';
                        sectionEl.style.transition = 'all 0.3s ease-out';
                        
                        setTimeout(() => {
                            sectionEl.style.opacity = '1';
                            sectionEl.style.maxHeight = '1000px';
                        }, 10);
                        
                        setTimeout(() => {
                            sectionEl.style.maxHeight = '';
                            sectionEl.style.overflow = '';
                            sectionEl.style.transition = '';
                        }, 300);
                    } else {
                        sectionEl.style.transition = 'all 0.3s ease-out';
                        sectionEl.style.opacity = '0';
                        sectionEl.style.maxHeight = '0';
                        sectionEl.style.overflow = 'hidden';
                        icon.style.transform = 'rotate(-90deg)';
                        
                        setTimeout(() => {
                            sectionEl.style.display = 'none';
                            sectionEl.style.transition = '';
                        }, 300);
                    }
                });
            });
        }
        
        function setupTooltips() {
            const tooltips = {
                'education': 'Seu n√≠vel de escolaridade nos ajuda a sugerir concursos adequados',
                'workStatus': 'Sua situa√ß√£o profissional influencia no tempo dispon√≠vel para estudos',
                'concursosCount': 'Essa informa√ß√£o nos ajuda a adaptar o conte√∫do para seu n√≠vel de experi√™ncia',
                'studyHours': 'Usado para criar cronogramas realistas e personalizar suas metas',
                'timelineGoal': 'Definir um prazo nos ajuda a criar um plano de estudos eficiente'
            };
            
            Object.keys(tooltips).forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    const label = field.previousElementSibling;
                    if (label && label.tagName === 'LABEL') {
                        label.setAttribute('data-tooltip', tooltips[fieldId]);
                        label.classList.add('tooltip');
                        label.style.cursor = 'help';
                    }
                }
            });
        }
        
        function showProfileCompletionTips() {
            // Mostrar dica sobre a import√¢ncia de completar o perfil
            setTimeout(() => {
                const incompleteFields = checkProfileCompleteness();
                if (incompleteFields.length > 0) {
                    app.showToast(
                        `Complete seu perfil para uma experi√™ncia personalizada! ${incompleteFields.length} campos restantes.`,
                        'info',
                        5000
                    );
                }
            }, 2000);
        }
        
        function checkProfileCompleteness() {
            const requiredFields = [
                { id: 'name', name: 'Nome' },
                { id: 'state', name: 'Estado' },
                { id: 'education', name: 'Escolaridade' },
                { id: 'areaInterest', name: '√Årea de Interesse' },
                { id: 'levelDesired', name: 'N√≠vel Desejado' },
                { id: 'studyHours', name: 'Horas de Estudo' }
            ];
            
            return requiredFields.filter(field => {
                const element = document.getElementById(field.id);
                return !element || !element.value.trim();
            });
        }
        
        function updateProgressBar() {
            const allFields = [
                'name', 'state', 'city', 'birthDate', 'education', 'workStatus',
                'concursosCount', 'areaInterest', 'levelDesired', 'timelineGoal', 'studyHours'
            ];
            
            let completedFields = 0;
            
            // Contar campos preenchidos
            allFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element && element.value.trim()) {
                    completedFields++;
                }
            });
            
            // Verificar radio buttons
            const firstTimeRadio = document.querySelector('input[name="firstTime"]:checked');
            if (firstTimeRadio) completedFields++;
            
            // Verificar se tem avatar
            if (selectedAvatarPath) completedFields++;
            
            const totalFields = allFields.length + 2; // +2 para firstTime e avatar
            const percentage = Math.round((completedFields / totalFields) * 100);
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (progressBar && progressText) {
                progressBar.style.setProperty('--progress', percentage + '%');
                progressText.textContent = percentage + '%';
                
                // Mudar cor baseada no progresso
                const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success').trim();
                const warningColor = getComputedStyle(document.documentElement).getPropertyValue('--warning').trim();
                const errorColor = getComputedStyle(document.documentElement).getPropertyValue('--error').trim();
                const borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border').trim();
                
                if (percentage >= 80) {
                    progressBar.style.background = `linear-gradient(90deg, ${successColor} ${percentage}%, ${borderColor} ${percentage}%)`;
                } else if (percentage >= 50) {
                    progressBar.style.background = `linear-gradient(90deg, ${warningColor} ${percentage}%, ${borderColor} ${percentage}%)`;
                } else {
                    progressBar.style.background = `linear-gradient(90deg, ${errorColor} ${percentage}%, ${borderColor} ${percentage}%)`;
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
    
    <!-- Script do rodap√© modular -->
    <script src="js/footer.js"></script>
    <!-- O rodap√© ser√° inserido automaticamente aqui pelo footer.js -->
</body>
</html>
